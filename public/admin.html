<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Admin • Texture Packs</title>
<link rel="stylesheet" href="admin.css">
<link rel="icon" href="/img/icon.png" type="image/x-icon">
</head>
<body>

<h2>Adicionar ou Atualizar Texture Pack</h2>

<form id="adminForm">
  <input type="text" name="id" placeholder="ID do Pack" required><br>
  <input type="text" name="name" placeholder="Nome" required><br>
  <input type="text" name="creator" placeholder="Criador" required><br>

  <select name="resolution" required>
    <option selected disabled>Resoluções</option>
    <option value="high">High</option>
    <option value="medium">Medium</option>
    <option value="low">Low</option>
    <option value="high-medium">High + Medium</option>
    <option value="high-low">High + Low</option>
    <option value="medium-low">Medium + Low</option>
  </select><br>

  <input type="url" name="download" placeholder="URL Download" required><br>
  <input type="text" name="description" placeholder="Descrição"><br>
  <input type="text" name="version" placeholder="Versão" required><br>
  <input type="url" name="icon" placeholder="Ícone (URL)" required><br>
  <input type="url" name="screenshot" placeholder="Screenshot (URL)" required><br>

  <button type="submit">Enviar</button>
</form>

<script>
const form = document.getElementById("adminForm");

form.addEventListener("submit", async e => {
    e.preventDefault();

    const senha = prompt("Digite a senha do administrador:");
    if (!senha) return alert("Operação cancelada.");

    const pack = {
        password: senha,
        id: form.id.value.trim(),
        name: form.name.value.trim(),
        creator: form.creator.value.trim(),
        resolution: form.resolution.value.includes("-")
            ? form.resolution.value.split("-")
            : [form.resolution.value],
        download: form.download.value.trim(),
        description: form.description.value.trim(),
        version: form.version.value.trim(),
        icon: form.icon.value.trim(),
        screenshot: form.screenshot.value.trim(),
        downloads: 0
    };

    try {
        // Primeiro tenta atualizar
        let res = await fetch("/api/packs", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(pack)
        });

        let data = await res.json();

        if (res.status === 401) {
            alert("❌ Senha incorreta!");
        } else if (res.status === 404) {
            // Se não existe, cria novo pack
            res = await fetch("/api/packs", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(pack)
            });
            data = await res.json();

            if (data.success) {
                alert("✔️ Pack adicionado com sucesso!");
                form.reset();
            } else {
                alert("⚠️ Erro: " + data.error);
            }

        } else if (data.success) {
            alert("✔️ Pack atualizado com sucesso!");
            form.reset();
        } else {
            alert("⚠️ Erro: " + data.error);
        }

    } catch (err) {
        console.error(err);
        alert("❌ Erro de conexão com servidor.");
    }
});
</script>

</body>
</html>
